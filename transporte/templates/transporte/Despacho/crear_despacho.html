{% extends 'transporte/base.html' %}

{% block content %}

<section class="py-3">
    <div class="container">
        <div class="p-4 text-white text-center shadow"
            style="background: linear-gradient(135deg,#1e3a8a,#3b82f6);
                   border-radius: 20px;">
            <h1 class="display-5 fw-bold">Crear Despacho</h1>
        </div>
    </div>
</section>

<section class="py-5">
    <div class="container">

        <a href="{% url 'lista_despacho' %}" class="btn btn-outline-primary mb-4">
            <i class="fas fa-arrow-left me-2"></i> Volver al listado
        </a>

        <div class="card shadow border-0 p-4 rounded-4">
            <h3 class="fw-bold mb-4">Nuevo Despacho</h3>

            <form method="POST">
                {% csrf_token %}

                <div class="mb-3">
                    <label class="form-label">Fecha de Despacho</label>
                    <input type="date" name="fecha_despacho" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Estado</label>
                    <select name="estado" class="form-select" required>
                        <option value="">Seleccionar estado...</option>
                        <option value="ER">En Ruta</option>
                        <option value="E">Entregado</option>
                        <option value="P">Pendiente</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Costo de Envío</label>
                    <input type="number" name="costo_envio" class="form-control" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Ruta</label>
                    <select name="ruta_id" class="form-select" required>
                        <option value="">Seleccionar Ruta...</option>
                        {% for r in ruta %}
                        <option value="{{ r.id }}">{{ r.origen }} - {{ r.destino }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Tipo de Transporte</label>
                    <select id="tipo_transporte" class="form-select" required>
                        <option value="">Seleccionar tipo...</option>
                        <option value="terrestre">Terrestre</option>
                        <option value="aereo">Aéreo</option>
                    </select>
                </div>

                <!-- Transporte Terrestre -->
                <div id="grupo_terrestre" style="display:none;">
                    <div class="mb-3">
                        <label class="form-label">Vehículo</label>
                        <select name="vehiculo_id" class="form-select">
                            <option value="">Seleccionar Vehículo...</option>
                            {% for v in vehiculos %}
                            <option value="{{ v.id }}">{{ v.patente }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Conductor</label>
                        <select name="conductor_id" class="form-select">
                            <option value="">Seleccionar Conductor...</option>
                            {% for c in conductores %}
                            <option value="{{ c.id }}">{{ c.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <!-- Transporte Aéreo -->
                <div id="grupo_aereo" style="display:none;">
                    <div class="mb-3">
                        <label class="form-label">Aeronave</label>
                        <select name="aeronave_id" class="form-select">
                            <option value="">Seleccionar Aeronave...</option>
                            {% for a in aeronaves %}
                            <option value="{{ a.id }}">{{ a.matricula }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Piloto</label>
                        <select name="piloto_id" class="form-select">
                            <option value="">Seleccionar Piloto...</option>
                            {% for p in pilotos %}
                            <option value="{{ p.id }}">{{ p.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label">Carga</label>
                    <select name="carga_id" class="form-select" required>
                        <option value="">Seleccionar Carga...</option>
                        {% for c in cargas %}
                        <option value="{{ c.id }}">{{ c.tipo }}</option>
                        {% endfor %}
                    </select>
                </div>

                <button class="btn btn-primary mt-3">
                    <i class="fas fa-save me-2"></i>
                    Guardar Despacho
                </button>

            </form>

        </div>

    </div>
</section>

<script>
document.getElementById("tipo_transporte").addEventListener("change", function () {
    const value = this.value;

    const terrestre = document.getElementById("grupo_terrestre");
    const aereo = document.getElementById("grupo_aereo");

    if (value === "terrestre") {
        terrestre.style.display = "block";
        aereo.style.display = "none";
    } 
    else if (value === "aereo") {
        terrestre.style.display = "none";
        aereo.style.display = "block";
    }
    else {
        terrestre.style.display = "none";
        aereo.style.display = "none";
    }
});
</script>


{% endblock %}
